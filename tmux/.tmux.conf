# -g — グローバル設定（全セッションに適用）
# -s — サーバー設定（tmuxサーバー全体に適用）
# -ag — グローバル設定に追記（上書きではなく既存値に追加）
# setw — set-window-optionの短縮形で、ウィンドウ単位のオプションを設定する

# ===== プレフィックスキー =====

# プレフィックスキーをCtrl+aに設定する（デフォルトはCtrl+b）
set -g prefix C-a

# デフォルトのCtrl+bのバインドを解除する
unbind C-b

# Ctrl+aを2回押したときに、そのままCtrl+aとしてアプリに送る
# （例：bashの行頭移動など、Ctrl+a本来の機能を使いたいとき）
bind C-a send-prefix

# ===== ペイン分割 =====

# prefix + | で画面を左右に分割する（-h = horizontal split）
# -c オプションで、新しいペインを現在のディレクトリで開く
bind | split-window -h -c "#{pane_current_path}"

# prefix + - で画面を上下に分割する（-v = vertical split）
bind - split-window -v -c "#{pane_current_path}"

# ===== マウス =====

# マウス操作を有効にする
# ペインのクリック切り替え、ドラッグでのリサイズ、スクロールが可能になる
set -g mouse on

# ===== インデックス番号 =====

# ウィンドウの番号を0ではなく1から始める
set -g base-index 1

# ペインの番号も0ではなく1から始める
setw -g pane-base-index 1

# ===== ペイン移動 =====

# prefix + h で左のペインに移動する
bind h select-pane -L

# prefix + j で下のペインに移動する
bind j select-pane -D

# prefix + k で上のペインに移動する
bind k select-pane -U

# prefix + l で右のペインに移動する
bind l select-pane -R

# ===== 設定リロード =====

# prefix + r で設定ファイルを再読み込みし、"Reloaded!"と表示する
# \; で複数のtmuxコマンドを連結している
bind r source-file ~/.tmux.conf \; display "Reloaded!"

# ===== 表示・ターミナル設定 =====

# tmuxが使用するターミナルタイプを設定する
# "tmux-256color"で256色表示に対応する
set -g default-terminal "tmux-256color"

# iTerm2等のxterm-256colorターミナルでTrueColor（24bitカラー）を有効にする
# -a は既存の値に追記するオプション
set -ag terminal-overrides ",xterm-256color:RGB"

# ステータスバーを画面上部に表示する（デフォルトは下部）
set -g status-position top

# ===== その他 =====

# Escキーを押してから実際に認識されるまでの遅延をなくす（ミリ秒）
# Vimなどでモード切り替え時にもたつくのを防ぐ
set -s escape-time 0

# スクロールバックで保持する行数を50000行に増やす（デフォルトは2000）
set -g history-limit 50000

# ウィンドウを閉じたときに番号の欠番を自動で詰める
# 例：ウィンドウ1,2,3のうち2を閉じると、3が2に繰り上がる
set -g renumber-windows on

# prefix + < で左に移動、prefix + > で右に移動
bind < swap-window -t -1 \; select-window -t -1
bind > swap-window -t +1 \; select-window -t +1

# エスケープシーケンスをtmuxを通過させてiTerm2に届ける
set -g allow-passthrough on
